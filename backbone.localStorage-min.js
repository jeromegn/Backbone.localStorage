/**
 * Backbone localStorage Adapter
 * Version 1.1.0
 *
 * https://github.com/jeromegn/Backbone.localStorage
 */(function(a,b){typeof define=="function"&&define.amd?define(["underscore","backbone"],function(c,d){return b(c||a._,d||a.Backbone)}):b(_,Backbone)})(this,function(a,b){function c(){return((1+Math.random())*65536|0).toString(16).substring(1)}function d(){return c()+c()+"-"+c()+"-"+c()+"-"+c()+"-"+c()+c()+c()}function e(b,c){var d=0;return b=a.reduce(b.replace(/-.*$/,"").split("."),function(a,b){return d++,a*=1e3,a+Number(b)},0),c=a.reduce(c.replace(/-.*$/,"").split("."),function(a,b){return d-->0?(a*=1e3,a+Number(b)):a},0),c>=b}return b.LocalStorage=window.Store=function(a){this.name=a;var b=this.localStorage().getItem(this.name);this.records=b&&b.split(",")||[]},a.extend(b.LocalStorage.prototype,{save:function(){this.localStorage().setItem(this.name,this.records.join(","))},create:function(a){return a.id||(a.id=d(),a.set(a.idAttribute,a.id)),this.localStorage().setItem(this.name+"-"+a.id,JSON.stringify(a)),this.records.push(a.id.toString()),this.save(),this.find(a)},update:function(b){return this.localStorage().setItem(this.name+"-"+b.id,JSON.stringify(b)),a.include(this.records,b.id.toString())||this.records.push(b.id.toString()),this.save(),this.find(b)},find:function(a){return this.jsonData(this.localStorage().getItem(this.name+"-"+a.id))},findAll:function(){return a(this.records).chain().map(function(a){return this.jsonData(this.localStorage().getItem(this.name+"-"+a))},this).compact().value()},destroy:function(b){return b.isNew()?!1:(this.localStorage().removeItem(this.name+"-"+b.id),this.records=a.reject(this.records,function(a){return a===b.id.toString()}),this.save(),b)},localStorage:function(){return localStorage},jsonData:function(a){return a&&JSON.parse(a)}}),b.LocalStorage.sync=window.Store.sync=b.localSync=function(a,c,d){var f=c.localStorage||c.collection.localStorage,g,h,i=$.Deferred&&$.Deferred();try{switch(a){case"read":g=c.id!=undefined?f.find(c):f.findAll();break;case"create":g=f.create(c);break;case"update":g=f.update(c);break;case"delete":g=f.destroy(c)}}catch(j){j.code===DOMException.QUOTA_EXCEEDED_ERR&&window.localStorage.length===0?h="Private browsing is unsupported":h=j.message}return g?(c.trigger("sync",c,g,d),d&&d.success&&(e("0.9.10",b.VERSION)?d.success(c,g,d):d.success(g)),i&&i.resolve(g)):(h=h?h:"Record Not Found",c.trigger("error",c,h,d),d&&d.error&&(e("0.9.10",b.VERSION)?d.error(c,h,d):d.error(h)),i&&i.reject(h)),d&&d.complete&&d.complete(g),i&&i.promise()},b.ajaxSync=b.sync,b.getSyncMethod=function(a){return a.localStorage||a.collection&&a.collection.localStorage?b.localSync:b.ajaxSync},b.sync=function(a,c,d){return b.getSyncMethod(c).apply(this,[a,c,d])},b.LocalStorage});